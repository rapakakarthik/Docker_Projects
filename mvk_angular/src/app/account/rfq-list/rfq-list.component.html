<section class="inquires-table-section">

  <!-- <section class="inquiry-headersection">
    <section>
      <button (click)="goToRfqQuote()" mat-raised-button class="signupBtn pad">
        Post an RFQ
      </button>
    </section>
    
    <form [formGroup]="form">
    <section>
      <mat-form-field appearance="outline" class="middlefiled selectmiddle marR20">
        <input formControlName="search" (keyup.enter)="getRfqList(skip)" matInput placeholder="Search.." >
      </mat-form-field>
      <mat-form-field appearance="outline" class="middlefiled selectmiddle marR20">
        <mat-label>Sort By</mat-label>
        <mat-select formControlName="sortBy" (selectionChange)="getRfqList(skip)">
          <mat-option [value]="'Asc'">
            Oldest
          </mat-option>
          <mat-option [value]="'Desc'">
            Latest
          </mat-option>
        </mat-select>
      </mat-form-field>
      <mat-checkbox disabled class="marR20" color="primary">New Quotaion</mat-checkbox>
      <mat-form-field appearance="outline" class="middlefiled selectmiddle">
        <mat-label>Filter By</mat-label>
        <mat-select formControlName="filter" (selectionChange)="getRfqList(skip)">
          <mat-option [value]="">
            All
          </mat-option>
          <mat-option [value]="'status_open'">
            Open
          </mat-option>
          <mat-option [value]="'status_onhold'">
            On Hold
          </mat-option>
          <mat-option [value]="'status_approved'">
            Approved
          </mat-option>
          <mat-option [value]="'status_rejected'">
            Rejected
          </mat-option>
          <mat-option [value]="'favourite'">
            Favourite
          </mat-option>
        </mat-select>
      </mat-form-field>
    </section>
    </form>
  </section> -->

  <div [formGroup]="form" class="table_row">
    <div class="left_side">
      <button (click)="goToRfqQuote()" class="primary_btn">Post an RFQ</button>
    </div>
    <div class="right_side">
      <div class="new_reply">
        <input (change)="getQuote()" formControlName="new_quote" type="checkbox" id="new_reply" name="new_reply">
        <label for="new_reply">New Quotation</label>
      </div>
      <select formControlName="filter" class="form-select" (change)="getRfqList(skip)">
        @for (filter of filters; track filter.id) {
          <option [value]="filter.id"> {{filter.value}} </option>
        }
      </select>
      <div class="search">
        <input formControlName="search" (input)="getRfqList(skip)" type="search" placeholder="Search">
        <i (click)="getRfqList(skip)" class="fa fa-search"></i>
      </div>
    </div>
  </div>

  <div class="mvk_table">
    <table>
      <thead>
        <tr>
          <th colspan="3" class="heading-td" scope="col">RFQ</th>
          <th colspan="3" class="heading-td" scope="col">Quotation from</th>
          <th colspan="3" class="heading-td statuscol text-center" scope="col">Status</th>
        </tr>
      </thead>
      <tbody>
        @if (noRfqFound) {
        <tr>
          <td colspan="12" class="text-center py-5">
            <img src="/assets/images/cloud.png"/>
            <h3 class="nofound_title">No RFQ's Found</h3>
          </td>
        </tr>
        }
        @else {
        <tr *ngFor="let rfq of rfqList | paginate: { itemsPerPage: 5, currentPage: p, totalItems: totalCount, id: 'rfq' }">
          <!-- <td colspan="3">
            <div (click)="addToFav(rfq.id, rfq.favourite)" class="fav_img">
              <svg id="Layer_1" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 213.15 194.93">
                <path d="M256,120.48c-.75,25.48-10.43,47-29.07,64.29-23.3,21.57-46.87,42.85-70.37,64.2-5.08,4.61-8.79,4.93-13.29.66-18.86-17.88-39.44-33.82-58.4-51.56-11.17-10.45-22.37-20.95-29.79-34.6-10.39-19.1-16-39.14-9.34-60.72,6.89-22.33,20.95-38,44.31-43.76,15.56-3.81,29.26,1.24,41.75,10.35,3.71,2.71,7,5.94,10.76,8.62,5.34,3.83,8.94,3.67,14.19-.22a40.82,40.82,0,0,0,4.1-3.42c28.43-27.63,67-17,84.65,11.28A66.36,66.36,0,0,1,256,120.48Zm-3.94-.24c-.78-15.38-5.5-27.19-13.62-37.67-12.8-16.49-33.36-23.93-52.1-18.86-9.42,2.55-17,8.19-24.08,14.65-9.34,8.48-15.89,8.41-25.42.26a114.12,114.12,0,0,0-9.39-7.49C116.94,64,105.52,60,92.6,62.47c-16.67,3.24-28.7,13-37.08,27.4-12.56,21.61-10.29,43.42-.36,65.22,7.05,15.49,18.59,27.46,31,38.61,17.86,16.09,36.15,31.69,54.05,47.73,10.1,9.06,8.36,9.6,18.91-.13,22.8-21,46.57-41,68.51-62.93A81.52,81.52,0,0,0,252.06,120.24Z" transform="translate(-42.85 -57.71)"/>
                <path [class]="rfq.favourite == 1 ? 'cls-1' : 'cls-2'" d="M252.06,120.24a81.52,81.52,0,0,1-24.46,58.13c-21.94,21.93-45.71,41.91-68.51,62.93-10.55,9.73-8.81,9.19-18.91.13-17.9-16-36.19-31.64-54.05-47.73-12.38-11.15-23.92-23.12-31-38.61-9.93-21.8-12.2-43.61.36-65.22,8.38-14.4,20.41-24.16,37.08-27.4,12.92-2.5,24.34,1.48,34.85,8.66a114.12,114.12,0,0,1,9.39,7.49c9.53,8.15,16.08,8.22,25.42-.26,7.11-6.46,14.66-12.1,24.08-14.65,18.74-5.07,39.3,2.37,52.1,18.86C246.56,93.05,251.28,104.86,252.06,120.24Z" transform="translate(-42.85 -57.71)"/>
              </svg>
            </div>
          </td> -->
          <td colspan="3">
            <section class="table-data-first">
              <ul class="list-group">
                <li class="list-group-item">
                  <span class="time-date">
                    {{ rfq.created_at }}
                    <span> ID: {{ rfq.code }} </span>
                  </span>
                </li>
                <li class="list-group-item">
                  <p>
                    {{ rfq.product_name }}
                  </p>
                </li>
                <li class="list-group-item">
                    <span class="time-date">
                      {{rfq.quantity}} {{rfq.units}}
                    </span>
                  </li>
              </ul>
            </section>
          </td>
          <td colspan="3">
            <section>
              <span class="quotation-text">
                {{ rfq.quote_count }} Quotes Recieved
                @if (rfq.unread_quote_count > 0) {
                  , <span (click)="goTo(rfq.id)" class="text_btn"> {{rfq.unread_quote_count}} New</span>
                }
              </span>
            </section>
          </td>
          <td class="statuscol" colspan="3">
            @if (rfq.created_by == 'mvk' && rfq.buyer_status == 'Open') {
              <div class="text-center mb-2">
                <button (click)="approve(rfq.id, 'approved')" class="approve_btn">
                  <svg xmlns="http://www.w3.org/2000/svg" width="19" height="18" viewBox="0 0 19 18" fill="none">
                    <path d="M7.1 11.9286L4.475 9.30355C4.1825 9.01105 3.7175 9.01105 3.425 9.30355C3.1325 9.59605 3.1325 10.0611 3.425 10.3536L6.5675 13.4961C6.86 13.7886 7.3325 13.7886 7.625 13.4961L15.575 5.55355C15.8675 5.26105 15.8675 4.79605 15.575 4.50355C15.2825 4.21105 14.8175 4.21105 14.525 4.50355L7.1 11.9286Z" fill="#3FA950"/>
                  </svg>
                  <span>Approve</span>
                </button>
              </div>
              <div class="text-center mb-2">
                <button (click)="approve(rfq.id, 'rejected')" class="reject_btn">
                  <svg xmlns="http://www.w3.org/2000/svg" width="19" height="18" viewBox="0 0 19 18" fill="none">
                    <path d="M14.225 4.28267C14.1556 4.21314 14.0732 4.15798 13.9825 4.12034C13.8917 4.08271 13.7945 4.06333 13.6962 4.06333C13.598 4.06333 13.5008 4.08271 13.41 4.12034C13.3193 4.15798 13.2369 4.21314 13.1675 4.28267L9.5 7.94267L5.8325 4.27517C5.76306 4.20573 5.68063 4.15065 5.58991 4.11307C5.49918 4.07549 5.40195 4.05615 5.30375 4.05615C5.20555 4.05615 5.10832 4.07549 5.01759 4.11307C4.92687 4.15065 4.84444 4.20573 4.775 4.27517C4.70556 4.3446 4.65048 4.42704 4.6129 4.51776C4.57533 4.60848 4.55598 4.70572 4.55598 4.80392C4.55598 4.90212 4.57533 4.99935 4.6129 5.09008C4.65048 5.1808 4.70556 5.26323 4.775 5.33267L8.4425 9.00017L4.775 12.6677C4.70556 12.7371 4.65048 12.8195 4.6129 12.9103C4.57533 13.001 4.55598 13.0982 4.55598 13.1964C4.55598 13.2946 4.57533 13.3919 4.6129 13.4826C4.65048 13.5733 4.70556 13.6557 4.775 13.7252C4.84444 13.7946 4.92687 13.8497 5.01759 13.8873C5.10832 13.9248 5.20555 13.9442 5.30375 13.9442C5.40195 13.9442 5.49918 13.9248 5.58991 13.8873C5.68063 13.8497 5.76306 13.7946 5.8325 13.7252L9.5 10.0577L13.1675 13.7252C13.2369 13.7946 13.3194 13.8497 13.4101 13.8873C13.5008 13.9248 13.5981 13.9442 13.6962 13.9442C13.7944 13.9442 13.8917 13.9248 13.9824 13.8873C14.0731 13.8497 14.1556 13.7946 14.225 13.7252C14.2944 13.6557 14.3495 13.5733 14.3871 13.4826C14.4247 13.3919 14.444 13.2946 14.444 13.1964C14.444 13.0982 14.4247 13.001 14.3871 12.9103C14.3495 12.8195 14.2944 12.7371 14.225 12.6677L10.5575 9.00017L14.225 5.33267C14.51 5.04767 14.51 4.56767 14.225 4.28267Z" fill="#D63333"/>
                  </svg>
                  <span>Reject</span>
                </button>
              </div>            
            }
            @else {
              <div class="text-center mb-2">
                <button class="status_btn" [ngStyle]="getSpanStyle(rfq.show_rfq_status)">
                  {{ rfq.show_rfq_status }}
                </button>
              </div>
            }
            <div *ngIf="rfq.quote_count > 0" class="text-center mb-2">
              <button (click)="goTo(rfq.id)" class="primary_btn">View Quotes</button>
            </div>
            <div class="text-center">
              <button (click)="handleClick(rfq.id)" type="button" class="text_btn">
                View this RFQ
              </button>
            </div>
          </td>
        </tr>
        }
      </tbody>
    </table>
  </div>
</section>

<section *ngIf="totalCount > 5" class="paginaton">
  <pagination-controls [maxSize]="5" (pageChange)="onPageChange($event)" id="rfq"></pagination-controls>    
</section>

<section class="inquiry-popup" *ngIf="showrfqDetails">
  <section class="inquiry-heading-popup">
    <h4>
      <mat-icon
        class="inquiry-close rfq-btn-inqury"
        (click)="toggleRfqProfile()"
        >close</mat-icon
      >
      RFQ Details
    </h4>
  </section>

  <app-rfqlist-details
    (rfqClosed)="rfqClosed()"
    [id]="rfqId"
  ></app-rfqlist-details>
</section>

<section *ngIf="serverDown">
  <app-server-down></app-server-down>
</section>